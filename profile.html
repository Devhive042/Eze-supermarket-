<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile ‚Äì Eze Supermarket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;}
    :root{--blue:#007bff;--bg:#f5f7fb;--card:#fff;--text:#333}
    body{margin:0;min-height:100vh;background:var(--bg);color:var(--text);display:flex;flex-direction:column;transition:.2s}
    body.dark{--bg:#111216;--card:#1f2124;--text:#eaeaea}

    header{background:var(--blue);color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
    header .left{display:flex;align-items:center;gap:12px}
    header h1{margin:0;font-size:18px}
    header .right{display:flex;align-items:center;gap:12px}
    .balance{font-weight:600}

    nav{position:fixed;left:-260px;top:0;height:100vh;width:240px;background:var(--card);box-shadow:2px 0 10px rgba(0,0,0,.12);padding:20px;transition:left .28s;z-index:1200}
    nav.active{left:0}
    nav h2{margin:0 0 16px;color:var(--blue)}
    nav ul{list-style:none;padding:0;margin:0}
    nav li{margin-bottom:12px}
    nav a{text-decoration:none;color:inherit;display:block;padding:8px;border-radius:8px}
    nav a:hover{background:var(--blue);color:#fff}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:1100}
    .overlay.active{display:block}

    main{flex:1;padding:20px;margin-top:10px}
    h2{color:var(--blue);margin-top:0}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin-bottom:16px}
    body.dark .card{background:var(--card)}

    label{font-weight:600;display:block;margin-bottom:6px}
    input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-bottom:12px}
    button.primary{background:var(--blue);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}

    .profile-pic{display:flex;flex-direction:column;align-items:center;margin-bottom:16px}
    .profile-pic img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:2px solid var(--blue);margin-bottom:8px}
    .profile-pic input{display:none}
    .upload-btn{background:var(--blue);color:#fff;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-size:14px}

    footer{padding:12px 20px;text-align:center;color:#777;font-size:13px;border-top:1px solid rgba(0,0,0,.03)}
  </style>
</head>
<body>
  <!-- Overlay -->
  <div id="overlay" class="overlay"></div>

  <!-- Sidebar -->
  <nav id="sidebar">
    <h2>Menu</h2>
    <ul>
      <li><a href="dashboard.html">üè† Dashboard</a></li>
      <li><a href="profile.html">üë§ Profile</a></li>
      <li><a href="add-money.html">üí≥ Add Money</a></li>
      <li><a href="cart.html">üõí Cart</a></li>
      <li><a href="products.html">üì¶ Products</a></li>
      <li><a href="receipts.html">üßæ Receipts</a></li>
      <li><a href="history.html">üìä History</a></li>
      <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
    </ul>
  </nav>

  <!-- Top bar -->
  <header>
    <div class="left">
      <button id="menuBtn" style="background:transparent;border:1px solid rgba(255,255,255,.17);color:#fff;padding:6px 8px;border-radius:6px;cursor:pointer">‚ò∞</button>
      <h1>Profile</h1>
    </div>
    <div class="right">
      <div class="balance">Balance: ‚Ç¶<span id="balance">0</span></div>
      <button id="logoutHeader" class="primary">Logout</button>
    </div>
  </header>

  <!-- Main -->
  <main>
    <h2>User Profile</h2>
    <div class="card">
      <div class="profile-pic">
        <img id="profileImg" src="https://via.placeholder.com/100" alt="Profile Picture">
        <label for="uploadPic" class="upload-btn">Upload Picture</label>
        <input type="file" id="uploadPic" accept="image/*">
      </div>

      <form id="profileForm">
        <label for="name">Full Name</label>
        <input type="text" id="name" required>

        <label for="email">Email (uneditable)</label>
        <input type="email" id="email" readonly>

        <label for="phone">Phone (uneditable)</label>
        <input type="tel" id="phone" readonly>

        <button type="submit" class="primary">Save Changes</button>
      </form>
    </div>

    <div class="card">
      <h3>Change Password</h3>
      <form id="passwordForm">
        <label for="currentPassword">Current Password</label>
        <input type="password" id="currentPassword" required>

        <label for="newPassword">New Password</label>
        <input type="password" id="newPassword" required>

        <label for="confirmPassword">Confirm New Password</label>
        <input type="password" id="confirmPassword" required>

        <button type="submit" class="primary">Update Password</button>
      </form>
    </div>
  </main>

  <footer>Powered by Eze Supermarket</footer>

  <script>
    const $ = id => document.getElementById(id);

    // Sidebar
    const menuBtn = $('menuBtn'), sidebar = $('sidebar'), overlay = $('overlay');
    menuBtn.onclick = () => { sidebar.classList.add('active'); overlay.classList.add('active'); };
    overlay.onclick = () => { sidebar.classList.remove('active'); overlay.classList.remove('active'); };

    // Active user
    let activeUser = JSON.parse(localStorage.getItem('activeUser') || 'null');
    if(!activeUser) location.href = 'login.html';

    // Balance
    function renderBalance(){
      activeUser = JSON.parse(localStorage.getItem('activeUser') || '{}');
      $('balance').textContent = (activeUser.balance || 0).toLocaleString();
    }
    renderBalance();

    // Load profile
    $('name').value = activeUser.name || '';
    $('email').value = activeUser.email || '';
    $('phone').value = activeUser.phone || '';
    if(activeUser.picture){ $('profileImg').src = activeUser.picture; }

    // Save profile
    $('profileForm').onsubmit = e => {
      e.preventDefault();
      activeUser.name = $('name').value.trim();

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      users = users.map(u => u.email === activeUser.email ? activeUser : u);
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('activeUser', JSON.stringify(activeUser));
      alert('Profile updated successfully!');
    };

    // Change password
    $('passwordForm').onsubmit = e => {
      e.preventDefault();
      const current = $('currentPassword').value;
      const newPass = $('newPassword').value;
      const confirm = $('confirmPassword').value;

      if(current !== activeUser.password) return alert("Current password is incorrect!");
      if(newPass.length < 8) return alert("Password must be at least 8 characters.");
      if(newPass !== confirm) return alert("Passwords do not match!");

      activeUser.password = newPass;
      localStorage.setItem('activeUser', JSON.stringify(activeUser));

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      users = users.map(u => u.email === activeUser.email ? activeUser : u);
      localStorage.setItem('users', JSON.stringify(users));

      alert("Password updated!");
      e.target.reset();
    };

    // Upload picture
    $('uploadPic').onchange = e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        $('profileImg').src = reader.result;
        activeUser.picture = reader.result;
        localStorage.setItem('activeUser', JSON.stringify(activeUser));
      };
      reader.readAsDataURL(file);
    };

    // Logout
    $('logoutHeader').onclick = () => {
      localStorage.removeItem('activeUser');
      location.href = 'login.html';
    };

    // Theme sync
    function applyTheme(){
      const theme = localStorage.getItem('theme') || 'light';
      document.body.classList.toggle('dark', theme === 'dark');
    }
    applyTheme();
    window.addEventListener('storage', () => { renderBalance(); applyTheme(); });
  </script>
</body>
</html>