<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eze Supermarket ‚Äì Cart</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;}
:root{--blue:#007bff;--bg:#f5f7fb;--card:#fff;--text:#333;}
body{margin:0;min-height:100vh;background:var(--bg);color:var(--text);transition:.3s;}
body.dark{--bg:#111216;--card:#1f2124;--text:#eaeaea;}

header{background:var(--blue);color:#fff;padding:14px;display:flex;align-items:center;justify-content:space-between;}
header h1{margin:0;font-size:18px;}
.balance{font-weight:600;}

.hamburger{font-size:22px;cursor:pointer;background:none;border:none;color:#fff;margin-right:12px;}
nav{position:fixed;top:0;left:-260px;width:240px;height:100%;background:var(--card);box-shadow:2px 0 6px rgba(0,0,0,.2);padding:20px;transition:.3s;z-index:1000;}
nav.active{left:0;}
nav h2{margin:0 0 16px;color:var(--blue);}
nav ul{list-style:none;padding:0;margin:0;}
nav li{margin-bottom:12px;}
nav a{text-decoration:none;color:inherit;display:block;padding:8px;border-radius:6px;}
nav a:hover{background:var(--blue);color:#fff;}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:900;}
.overlay.active{display:block;}

main{flex:1;padding:20px;margin-top:10px;}
h2{color:var(--blue);margin-top:0;}

.cart-item{display:flex;align-items:center;background:var(--card);padding:12px;border-radius:10px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.08);}
body.dark .cart-item{background:#2b2b2b;color:#eee;}
.cart-item img{width:80px;height:80px;object-fit:cover;border-radius:6px;margin-right:12px;}
.cart-item .details{flex:1;}
.cart-item .details h3{margin:0 0 6px;font-size:16px;}
.cart-item .details p{margin:0 0 4px;font-size:14px;}
.cart-item .actions{display:flex;align-items:center;gap:6px;}
.cart-item button{padding:6px 10px;border:none;border-radius:6px;background:var(--blue);color:#fff;cursor:pointer;}
.cart-item button:hover{opacity:.9;}

.total-box{margin-top:20px;font-weight:600;font-size:16px;text-align:right;}
button.checkout{margin-top:10px;padding:10px 16px;border:none;border-radius:6px;background:var(--blue);color:#fff;cursor:pointer;}
button.checkout:hover{opacity:.9;}
</style>
</head>
<body>

<div class="overlay" id="overlay"></div>

<nav id="sidebar">
<h2>Menu</h2>
<ul>
<li><a href="dashboard.html">üè† Dashboard</a></li>
<li><a href="profile.html">üë§ Profile</a></li>
<li><a href="add-money.html">üí≥ Add Money</a></li>
<li><a href="cart.html" class="active">üõí Cart</a></li>
<li><a href="products.html">üì¶ Products</a></li>
<li><a href="receipts.html">üßæ Receipts</a></li>
<li><a href="history.html">üìä History</a></li>
</ul>
</nav>

<header>
<div style="display:flex;align-items:center;">
<button class="hamburger" id="menuBtn">‚ò∞</button>
<h1>Cart</h1>
</div>
<div class="balance">Balance: ‚Ç¶<span id="balance">0</span></div>
</header>

<main>
<h2>Your Cart</h2>
<div id="cartList"></div>
<div class="total-box" id="cartTotal">Total: ‚Ç¶0</div>
<button class="checkout" id="checkoutBtn">Checkout</button>
</main>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
const $ = id=>document.getElementById(id);

// Hamburger toggle
const menuBtn = $('menuBtn'), sidebar = $('sidebar'), overlay = $('overlay');
menuBtn.onclick = () => {sidebar.classList.add('active'); overlay.classList.add('active');};
overlay.onclick = () => {sidebar.classList.remove('active'); overlay.classList.remove('active');};
document.querySelectorAll('#sidebar a').forEach(a=>a.addEventListener('click',()=>{sidebar.classList.remove('active'); overlay.classList.remove('active');}));

// Load active user
let activeUser = JSON.parse(localStorage.getItem('activeUser')||'{}');
if(!activeUser.email) location.href='login.html';
$('balance').textContent = Number(activeUser.balance||0).toLocaleString();

// Load cart
let cart = JSON.parse(localStorage.getItem('cart')||'[]');
const cartList = $('cartList');
const cartTotal = $('cartTotal');

function renderCart(){
    cartList.innerHTML = '';
    if(cart.length===0){cartList.innerHTML='<p>Cart is empty.</p>'; cartTotal.textContent='Total: ‚Ç¶0'; return;}
    let total = 0;
    cart.forEach((p,i)=>{
        const item = document.createElement('div');
        item.className='cart-item';
        const itemTotal = p.price * p.qty;
        total += itemTotal;
        item.innerHTML = `
            <img src="${p.img}" alt="${p.name}">
            <div class="details">
                <h3>${p.name}</h3>
                <p>‚Ç¶${p.price.toLocaleString()} x ${p.qty} = ‚Ç¶${itemTotal.toLocaleString()}</p>
            </div>
            <div class="actions">
                <button class="dec">-</button>
                <button class="inc">+</button>
                <button class="remove">üóëÔ∏è</button>
            </div>
        `;
        item.querySelector('.inc').onclick = () => {p.qty++; saveCart();};
        item.querySelector('.dec').onclick = () => {if(p.qty>1)p.qty--; saveCart();};
        item.querySelector('.remove').onclick = () => {cart.splice(i,1); saveCart();};
        cartList.appendChild(item);
    });
    cartTotal.textContent = 'Total: ‚Ç¶'+total.toLocaleString();
}

function saveCart(){
    localStorage.setItem('cart',JSON.stringify(cart));
    renderCart();
}
renderCart();

// Checkout
$('checkoutBtn').onclick = () => {
    if(cart.length===0){alert('Cart is empty.'); return;}
    let total = cart.reduce((sum,p)=>sum+p.price*p.qty,0);
    if(activeUser.balance<total){alert('Insufficient balance!'); return;}
    activeUser.balance -= total;
    localStorage.setItem('activeUser',JSON.stringify(activeUser));
    $('balance').textContent = Number(activeUser.balance).toLocaleString();

    // Save purchase to history with user email
    let history = JSON.parse(localStorage.getItem('history')||'[]');
    const purchase = {
        id:Date.now(),
        user: activeUser.email,
        items: [...cart],
        total: total,
        date: new Date().toLocaleString()
    };
    history.push(purchase);
    localStorage.setItem('history',JSON.stringify(history));

    // Clear cart
    cart = [];
    localStorage.setItem('cart',JSON.stringify(cart));
    renderCart();

    // Optional: show receipt download
    const receiptDiv = document.createElement('div');
    receiptDiv.style.padding='12px'; receiptDiv.style.background='#fff'; receiptDiv.style.border='1px solid #ccc';
    receiptDiv.innerHTML = `<h3>Purchase Receipt</h3>` + purchase.items.map(i=>`<p>${i.name} x ${i.qty} = ‚Ç¶${(i.price*i.qty).toLocaleString()}</p>`).join('') + `<p>Total: ‚Ç¶${purchase.total.toLocaleString()}</p>`;
    document.body.appendChild(receiptDiv);

    html2canvas(receiptDiv).then(canvas=>{
        const link = document.createElement('a');
        link.download = `receipt_${purchase.id}.png`;
        link.href = canvas.toDataURL();
        link.click();
        document.body.removeChild(receiptDiv);
    });
}

// Dark mode sync
const theme = localStorage.getItem('theme');
if(theme==='dark') document.body.classList.add('dark');
window.addEventListener('storage', e=>{
    if(e.key==='theme') document.body.classList.toggle('dark', localStorage.getItem('theme')==='dark');
});
</script>

</body>
</html>